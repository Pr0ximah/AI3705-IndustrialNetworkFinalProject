{
  "name": "transfer_machine",
  "var_input": [
    {
      "name": "Speed",
      "type": "float",
      "description": "输送机运行速度(m/s)"
    },
    {
      "name": "LoadWeight",
      "type": "float",
      "description": "当前负载重量(kg)"
    }
  ],
  "var_output": [
    {
      "name": "CurrentSpeed",
      "type": "float",
      "description": "实际运行速度(m/s)"
    },
    {
      "name": "Overload",
      "type": "bool",
      "description": "过载报警信号"
    }
  ],
  "signal_input": [
    {
      "name": "Start",
      "description": "启动信号"
    },
    {
      "name": "Stop",
      "description": "停止信号"
    },
    {
      "name": "EmergencyStop",
      "description": "急停信号"
    }
  ],
  "signal_output": [
    {
      "name": "Running",
      "description": "运行状态信号"
    },
    {
      "name": "Alarm",
      "description": "故障报警信号"
    }
  ],
  "InternalVars": [
    {
      "name": "IsRunning",
      "type": "bool",
      "InitalVaule": "FALSE",
      "description": "记录输送机当前运行状态"
    },
    {
      "name": "FaultDetected",
      "type": "bool",
      "InitalVaule": "FALSE",
      "description": "故障检测标志"
    }
  ],
  "ECC": {
    "ECStates": [
      {
        "name": "Idle",
        "comment": "初始待机状态",
        "x": 50,
        "y": 50
      },
      {
        "name": "Running",
        "comment": "正常运行状态",
        "x": 200,
        "y": 50,
        "ecAction": {
          "algorithm": "RunTransfer",
          "output": "Running"
        }
      },
      {
        "name": "EmergencyStop",
        "comment": "急停状态",
        "x": 200,
        "y": 150,
        "ecAction": {
          "algorithm": "EmergencyStop",
          "output": "Alarm"
        }
      },
      {
        "name": "Fault",
        "comment": "故障状态",
        "x": 350,
        "y": 50,
        "ecAction": {
          "algorithm": "HandleFault",
          "output": "Alarm"
        }
      }
    ],
    "ECTransitions": [
      {
        "source": "Idle",
        "destination": "Running",
        "condition": "Start AND NOT FaultDetected",
        "comment": "收到启动信号且无故障",
        "x": 125,
        "y": 30
      },
      {
        "source": "Running",
        "destination": "Idle",
        "condition": "Stop",
        "comment": "收到停止信号",
        "x": 125,
        "y": 70
      },
      {
        "source": "Running",
        "destination": "EmergencyStop",
        "condition": "EmergencyStop",
        "comment": "收到急停信号",
        "x": 200,
        "y": 100
      },
      {
        "source": "Running",
        "destination": "Fault",
        "condition": "Overload OR FaultDetected",
        "comment": "检测到过载或故障",
        "x": 275,
        "y": 50
      },
      {
        "source": "EmergencyStop",
        "destination": "Idle",
        "condition": "Reset",
        "comment": "系统复位",
        "x": 125,
        "y": 200
      },
      {
        "source": "Fault",
        "destination": "Idle",
        "condition": "FaultCleared",
        "comment": "故障清除",
        "x": 250,
        "y": 100
      }
    ]
  },
  "Algorithms": [
    {
      "Name": "RunTransfer",
      "Comment": "控制输送机运行",
      "Input": "Speed, LoadWeight",
      "Output": "CurrentSpeed, Overload",
      "Code": "IF LoadWeight <= MaxLoad THEN\n    CurrentSpeed := Speed;\n    Overload := FALSE;\nELSE\n    CurrentSpeed := 0;\n    Overload := TRUE;\n    FaultDetected := TRUE;\nEND_IF;"
    },
    {
      "Name": "EmergencyStop",
      "Comment": "紧急停止处理",
      "Input": "",
      "Output": "",
      "Code": "CurrentSpeed := 0;\nIsRunning := FALSE;"
    },
    {
      "Name": "HandleFault",
      "Comment": "故障处理程序",
      "Input": "",
      "Output": "",
      "Code": "CurrentSpeed := 0;\nIsRunning := FALSE;\nAlarm := TRUE;"
    }
  ]
}