[
  {
    "name": "输送机",
    "var_input": [
      {
        "name": "MaterialPosition",
        "type": "bool",
        "description": "物料位置检测信号，TRUE表示物料到位"
      },
      {
        "name": "SpeedReference",
        "type": "float",
        "description": "输送机速度设定值(0-100%)"
      }
    ],
    "var_output": [
      {
        "name": "MotorSpeed",
        "type": "float",
        "description": "电机实际运行速度反馈"
      },
      {
        "name": "FaultStatus",
        "type": "int",
        "description": "故障状态码，0表示正常"
      }
    ],
    "signal_input": [
      {
        "name": "StartCmd",
        "description": "启动命令信号"
      },
      {
        "name": "StopCmd",
        "description": "急停命令信号"
      },
      {
        "name": "MaterialDetected",
        "description": "物料到位传感器信号"
      }
    ],
    "signal_output": [
      {
        "name": "MotorRun",
        "description": "电机运行控制信号"
      },
      {
        "name": "MaterialPresent",
        "description": "物料存在状态信号"
      }
    ],
    "InternalVars": [
      {
        "name": "IsRunning",
        "type": "bool",
        "InitalVaule": "FALSE",
        "description": "输送机运行状态标志"
      },
      {
        "name": "RunTimer",
        "type": "Time",
        "InitalVaule": "T#0s",
        "description": "运行时间累计"
      }
    ],
    "ECC": {
      "ECStates": [
        {
          "name": "Idle",
          "comment": "待机状态",
          "x": 50,
          "y": 50
        },
        {
          "name": "Accelerating",
          "comment": "加速阶段",
          "x": 200,
          "y": 50,
          "ecAction": {
            "algorithm": "RampUp",
            "output": "MotorRun"
          }
        },
        {
          "name": "Running",
          "comment": "正常运行",
          "x": 350,
          "y": 50,
          "ecAction": {
            "algorithm": "RunConveyor",
            "output": "MotorRun"
          }
        },
        {
          "name": "Decelerating",
          "comment": "减速停止",
          "x": 200,
          "y": 150,
          "ecAction": {
            "algorithm": "RampDown",
            "output": "MotorRun"
          }
        },
        {
          "name": "EmergencyStop",
          "comment": "急停状态",
          "x": 350,
          "y": 150,
          "ecAction": {
            "algorithm": "EmergencyStop",
            "output": "MotorRun"
          }
        }
      ],
      "ECTransitions": [
        {
          "source": "Idle",
          "destination": "Accelerating",
          "condition": "StartCmd AND NOT MaterialDetected",
          "comment": "收到启动命令且无物料",
          "x": 125,
          "y": 30
        },
        {
          "source": "Accelerating",
          "destination": "Running",
          "condition": "MotorSpeed >= SpeedReference",
          "comment": "达到设定速度",
          "x": 275,
          "y": 30
        },
        {
          "source": "Running",
          "destination": "Decelerating",
          "condition": "StopCmd OR MaterialDetected",
          "comment": "收到停止信号或检测到物料",
          "x": 350,
          "y": 100
        },
        {
          "source": "Decelerating",
          "destination": "Idle",
          "condition": "MotorSpeed <= 0",
          "comment": "完全停止",
          "x": 275,
          "y": 150
        },
        {
          "source": "Running",
          "destination": "EmergencyStop",
          "condition": "StopCmd",
          "comment": "急停命令",
          "x": 350,
          "y": 100
        },
        {
          "source": "EmergencyStop",
          "destination": "Idle",
          "condition": "ResetCmd",
          "comment": "复位后返回待机",
          "x": 350,
          "y": 200
        }
      ]
    },
    "Algorithms": [
      {
        "Name": "RunConveyor",
        "Comment": "输送机正常运行控制",
        "Input": "SpeedReference, MaterialDetected",
        "Output": "MotorSpeed, MaterialPresent",
        "Code": "IF NOT MaterialDetected THEN\n    MotorSpeed := SpeedReference;\n    MaterialPresent := FALSE;\nELSE\n    MotorSpeed := 0;\n    MaterialPresent := TRUE;\nEND_IF;"
      },
      {
        "Name": "RampUp",
        "Comment": "加速斜坡控制",
        "Input": "SpeedReference",
        "Output": "MotorSpeed",
        "Code": "MotorSpeed := MotorSpeed + (SpeedReference * 0.1);\nMotorSpeed := LIMIT(0, MotorSpeed, SpeedReference);"
      },
      {
        "Name": "RampDown",
        "Comment": "减速斜坡控制",
        "Input": "",
        "Output": "MotorSpeed",
        "Code": "MotorSpeed := MotorSpeed - (SpeedReference * 0.2);\nMotorSpeed := LIMIT(0, MotorSpeed, SpeedReference);"
      },
      {
        "Name": "EmergencyStop",
        "Comment": "紧急停止控制",
        "Input": "",
        "Output": "MotorSpeed",
        "Code": "MotorSpeed := 0;"
      }
    ]
  },
  {
    "name": "提升机",
    "var_input": [
      {
        "name": "CurrentPosition",
        "type": "float",
        "description": "当前提升机位置(米)"
      },
      {
        "name": "TargetPosition",
        "type": "float",
        "description": "目标提升位置(米)"
      },
      {
        "name": "LoadWeight",
        "type": "float",
        "description": "当前负载重量(kg)"
      }
    ],
    "var_output": [
      {
        "name": "MotorSpeed",
        "type": "float",
        "description": "电机运行速度(RPM)"
      },
      {
        "name": "PositionError",
        "type": "float",
        "description": "位置误差(米)"
      }
    ],
    "signal_input": [
      {
        "name": "StartLift",
        "description": "启动提升信号"
      },
      {
        "name": "EmergencyStop",
        "description": "急停信号"
      },
      {
        "name": "PositionReached",
        "description": "位置到达信号"
      }
    ],
    "signal_output": [
      {
        "name": "LiftRunning",
        "description": "提升机运行中信号"
      },
      {
        "name": "OverloadAlarm",
        "description": "超载报警信号"
      },
      {
        "name": "TargetReached",
        "description": "目标位置到达信号"
      }
    ],
    "InternalVars": [
      {
        "name": "IsMoving",
        "type": "bool",
        "InitalVaule": "FALSE",
        "description": "提升机移动状态标志"
      },
      {
        "name": "IsOverloaded",
        "type": "bool",
        "InitalVaule": "FALSE",
        "description": "超载状态标志"
      }
    ],
    "ECC": {
      "ECStates": [
        {
          "name": "Idle",
          "comment": "待机状态",
          "x": 50,
          "y": 50
        },
        {
          "name": "MovingUp",
          "comment": "上升状态",
          "x": 200,
          "y": 50,
          "ecAction": {
            "algorithm": "CalculateSpeed",
            "output": "MotorSpeed"
          }
        },
        {
          "name": "MovingDown",
          "comment": "下降状态",
          "x": 200,
          "y": 150,
          "ecAction": {
            "algorithm": "CalculateSpeed",
            "output": "MotorSpeed"
          }
        },
        {
          "name": "Emergency",
          "comment": "紧急停止状态",
          "x": 350,
          "y": 100,
          "ecAction": {
            "algorithm": "EmergencyStop",
            "output": "OverloadAlarm"
          }
        }
      ],
      "ECTransitions": [
        {
          "source": "Idle",
          "destination": "MovingUp",
          "condition": "StartLift AND TargetPosition > CurrentPosition",
          "comment": "收到上升指令",
          "x": 125,
          "y": 30
        },
        {
          "source": "Idle",
          "destination": "MovingDown",
          "condition": "StartLift AND TargetPosition < CurrentPosition",
          "comment": "收到下降指令",
          "x": 125,
          "y": 70
        },
        {
          "source": "MovingUp",
          "destination": "Idle",
          "condition": "PositionReached OR EmergencyStop",
          "comment": "到达目标或急停",
          "x": 225,
          "y": 30
        },
        {
          "source": "MovingDown",
          "destination": "Idle",
          "condition": "PositionReached OR EmergencyStop",
          "comment": "到达目标或急停",
          "x": 225,
          "y": 170
        },
        {
          "source": "MovingUp",
          "destination": "Emergency",
          "condition": "IsOverloaded",
          "comment": "上升过程中超载",
          "x": 275,
          "y": 50
        },
        {
          "source": "MovingDown",
          "destination": "Emergency",
          "condition": "IsOverloaded",
          "comment": "下降过程中超载",
          "x": 275,
          "y": 150
        },
        {
          "source": "Emergency",
          "destination": "Idle",
          "condition": "NOT EmergencyStop AND NOT IsOverloaded",
          "comment": "解除急停状态",
          "x": 225,
          "y": 100
        }
      ]
    },
    "Algorithms": [
      {
        "Name": "CalculateSpeed",
        "Comment": "计算电机运行速度",
        "Input": "CurrentPosition, TargetPosition, LoadWeight",
        "Output": "MotorSpeed, PositionError",
        "Code": "PositionError := ABS(TargetPosition - CurrentPosition);\nIF LoadWeight > MaxLoad THEN\n    IsOverloaded := TRUE;\n    MotorSpeed := 0;\nELSE\n    MotorSpeed := MIN(MaxSpeed, PositionError * SpeedFactor);\nEND_IF;"
      },
      {
        "Name": "EmergencyStop",
        "Comment": "紧急停止处理",
        "Input": "EmergencyStop, IsOverloaded",
        "Output": "OverloadAlarm",
        "Code": "IF EmergencyStop OR IsOverloaded THEN\n    OverloadAlarm := TRUE;\n    MotorSpeed := 0;\nELSE\n    OverloadAlarm := FALSE;\nEND_IF;"
      }
    ]
  },
  {
    "name": "移栽机",
    "var_input": [
      {
        "name": "CurrentPosition",
        "type": "float",
        "description": "当前移栽臂位置坐标(mm)"
      },
      {
        "name": "TargetPosition",
        "type": "float",
        "description": "目标移栽位置坐标(mm)"
      },
      {
        "name": "WorkpieceWeight",
        "type": "float",
        "description": "工件重量(kg)"
      }
    ],
    "var_output": [
      {
        "name": "MoveSpeed",
        "type": "float",
        "description": "移栽臂移动速度(mm/s)"
      },
      {
        "name": "GripperForce",
        "type": "float",
        "description": "夹爪夹持力(N)"
      }
    ],
    "signal_input": [
      {
        "name": "StartTransfer",
        "description": "启动移栽信号"
      },
      {
        "name": "EmergencyStop",
        "description": "急停信号"
      },
      {
        "name": "WorkpieceDetected",
        "description": "工件到位检测信号"
      }
    ],
    "signal_output": [
      {
        "name": "TransferComplete",
        "description": "移栽完成信号"
      },
      {
        "name": "Alarm",
        "description": "异常报警信号"
      }
    ],
    "InternalVars": [
      {
        "name": "IsMoving",
        "type": "bool",
        "InitalVaule": "FALSE",
        "description": "移栽臂移动状态标志"
      },
      {
        "name": "IsGripping",
        "type": "bool",
        "InitalVaule": "FALSE",
        "description": "夹爪夹持状态标志"
      }
    ],
    "ECC": {
      "ECStates": [
        {
          "name": "Idle",
          "comment": "待机状态",
          "x": 50,
          "y": 50
        },
        {
          "name": "MovingToPick",
          "comment": "移动至取件位置",
          "x": 200,
          "y": 50,
          "ecAction": {
            "algorithm": "CalculateMovePath",
            "output": "MoveSpeed"
          }
        },
        {
          "name": "Gripping",
          "comment": "夹取工件",
          "x": 350,
          "y": 50,
          "ecAction": {
            "algorithm": "CalculateGripForce",
            "output": "GripperForce"
          }
        },
        {
          "name": "MovingToPlace",
          "comment": "移动至放件位置",
          "x": 200,
          "y": 150,
          "ecAction": {
            "algorithm": "CalculateMovePath",
            "output": "MoveSpeed"
          }
        },
        {
          "name": "Releasing",
          "comment": "释放工件",
          "x": 50,
          "y": 150,
          "ecAction": {
            "algorithm": "ReleaseWorkpiece",
            "output": "TransferComplete"
          }
        },
        {
          "name": "Emergency",
          "comment": "紧急停止状态",
          "x": 350,
          "y": 150,
          "ecAction": {
            "algorithm": "EmergencyStop",
            "output": "Alarm"
          }
        }
      ],
      "ECTransitions": [
        {
          "source": "Idle",
          "destination": "MovingToPick",
          "condition": "StartTransfer AND WorkpieceDetected",
          "comment": "收到启动信号且工件到位",
          "x": 125,
          "y": 30
        },
        {
          "source": "MovingToPick",
          "destination": "Gripping",
          "condition": "CurrentPosition == TargetPosition",
          "comment": "到达取件位置",
          "x": 275,
          "y": 30
        },
        {
          "source": "Gripping",
          "destination": "MovingToPlace",
          "condition": "IsGripping",
          "comment": "夹取完成",
          "x": 275,
          "y": 100
        },
        {
          "source": "MovingToPlace",
          "destination": "Releasing",
          "condition": "CurrentPosition == TargetPosition",
          "comment": "到达放件位置",
          "x": 125,
          "y": 100
        },
        {
          "source": "Releasing",
          "destination": "Idle",
          "condition": "NOT IsGripping",
          "comment": "释放完成返回待机",
          "x": 50,
          "y": 100
        },
        {
          "source": "*",
          "destination": "Emergency",
          "condition": "EmergencyStop",
          "comment": "任何状态下收到急停信号",
          "x": 200,
          "y": 200
        }
      ]
    },
    "Algorithms": [
      {
        "Name": "CalculateMovePath",
        "Comment": "计算移栽臂移动路径和速度",
        "Input": "CurrentPosition, TargetPosition, WorkpieceWeight",
        "Output": "MoveSpeed",
        "Code": "VAR\n    Distance : REAL := ABS(TargetPosition - CurrentPosition);\n    MaxSpeed : REAL := 500.0; (* mm/s *)\n    WeightFactor : REAL := 1.0 - (WorkpieceWeight * 0.01);\nEND_VAR\n\nMoveSpeed := MIN(Distance * 0.5, MaxSpeed) * WeightFactor;"
      },
      {
        "Name": "CalculateGripForce",
        "Comment": "根据工件重量计算夹持力",
        "Input": "WorkpieceWeight",
        "Output": "GripperForce",
        "Code": "GripperForce := WorkpieceWeight * 9.8 * 1.5; (* 安全系数1.5 *)"
      },
      {
        "Name": "ReleaseWorkpiece",
        "Comment": "释放工件控制",
        "Input": "IsGripping",
        "Output": "TransferComplete",
        "Code": "IsGripping := FALSE;\nTransferComplete := TRUE;"
      },
      {
        "Name": "EmergencyStop",
        "Comment": "紧急停止处理",
        "Input": "EmergencyStop",
        "Output": "Alarm",
        "Code": "MoveSpeed := 0.0;\nGripperForce := 0.0;\nAlarm := TRUE;"
      }
    ]
  }
]
